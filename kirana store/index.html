<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apna Kirana - Online Grocery Store</title>
    <!-- Tailwind CSS for Layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* === FROM STYLE.CSS === */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom styles for animations and specific elements */
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popIn {
            0%   { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Hide scrollbar */
        .hide-scroll::-webkit-scrollbar {
            display: none;
        }

        .hide-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Input Group Styles */
        .input-group-text {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background-color: #f9fafb; /* Adjusted for better contrast */
            border: 1px solid #e5e7eb;
            border-right: none;
            border-radius: 0.5rem 0 0 0.5rem;
            color: #4b5563;
            font-weight: 500;
        }

        .input-group-field {
            border-radius: 0 0.5rem 0.5rem 0;
            border-left: none;
        }

        /* Slider Specific Styles */
        .category-card-shadow:hover {
            box-shadow: 0 10px 25px -5px rgba(22, 163, 74, 0.3);
        }

        /* Hero Slider Animation */
        #hero-slider {
            transition: background-image 1s ease-in-out;
        }
    </style>
</head>
<body class="relative bg-gray-50 text-gray-900 font-sans">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <!-- Top Strip -->
        <div class="bg-green-50 hidden md:flex justify-between px-4 lg:px-12 py-1 text-xs text-gray-600 border-b border-green-100">
            <span class="flex items-center"><i data-lucide="smartphone" class="w-3 h-3 mr-1"></i> Download App</span>
            <span>Customer Support: 1800-123-4567</span>
        </div>

        <!-- Main Header -->
        <div class="container mx-auto px-4 lg:px-12 py-3">
            <div class="flex items-center justify-between gap-4">
                
                <!-- Logo -->
                <a href="#" onclick="renderHome()" class="flex flex-col leading-none cursor-pointer">
                    <span class="text-2xl font-bold text-green-700 tracking-tight">Apna<span class="text-black">Kirana</span></span>
                    <span class="text-[10px] text-gray-500 uppercase tracking-wider">Fresh Grocery</span>
                </a>

                <!-- Location Selector -->
                <button onclick="toggleModal('location-modal')" class="hidden md:flex items-center text-sm text-gray-600 hover:text-green-700 bg-gray-50 px-2 py-1.5 rounded border border-transparent hover:border-green-200 transition-colors">
                    <i data-lucide="map-pin" class="w-4 h-4 mr-2 text-green-600"></i>
                    <span id="current-location" class="max-w-[120px] truncate">Mumbai, 400001</span>
                    <i data-lucide="chevron-down" class="w-3 h-3 ml-2"></i>
                </button>

                <!-- Search Bar -->
                <div class="flex-1 max-w-xl relative hidden sm:block">
                    <input type="text" id="search-input" placeholder="Search for 'Atta', 'Dal'..." 
                           class="w-full border border-gray-300 rounded-lg py-2 pl-4 pr-10 focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500 transition-all">
                    <button class="absolute right-0 top-0 h-full px-3 text-gray-400 hover:text-green-600">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                </div>

                <!-- Right Actions -->
                <div class="flex items-center gap-4">
                    <button id="login-btn" onclick="toggleModal('login-modal')" class="hidden md:flex items-center gap-2 text-sm font-medium hover:text-green-600">
                        <i data-lucide="user" class="w-5 h-5"></i>
                        <span id="user-name">Login</span>
                    </button>

                    <button onclick="showCart()" class="relative p-2 bg-green-50 rounded-full hover:bg-green-100 text-green-800 transition-colors">
                        <i data-lucide="shopping-cart" class="w-6 h-6"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full border-2 border-white">0</span>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Search -->
            <div class="mt-3 sm:hidden relative">
                <input type="text" id="mobile-search-input" placeholder="Search products..." 
                       class="w-full border border-gray-300 rounded-lg py-2 pl-3 pr-10 text-sm">
                <i data-lucide="search" class="w-4 h-4 absolute right-3 top-2.5 text-gray-400"></i>
            </div>
        </div>

        <!-- Navigation Categories -->
        <nav class="border-t border-gray-100 bg-white hidden md:block">
            <div class="container mx-auto px-12">
                <ul class="flex gap-8 py-3 text-sm font-medium text-gray-700 overflow-x-auto hide-scroll" id="nav-categories">
                    <!-- Categories injected by JS -->
                </ul>
            </div>
        </nav>
    </header>

    <!-- MAIN CONTENT AREA -->
    <div id="app-content">
        
        <!-- === HOME VIEW === -->
        <div id="home-view">
            <!-- Hero Banner (Slider) -->
            <!-- Reduced vertical padding (py-10) to make it more compact -->
            <section id="hero-slider" class="relative py-10 md:py-16 mb-6 overflow-hidden transition-all duration-1000 ease-in-out bg-gray-900 bg-cover bg-center" style="background-image: url('background.jpg');">
                <!-- Dark Overlay for readability -->
                <div class="absolute inset-0 bg-black bg-opacity-50 z-0"></div>
                
                <div class="container mx-auto px-4 lg:px-12 relative z-10 text-white">
                    <span class="bg-yellow-400 text-green-900 text-xs font-bold px-2 py-1 rounded uppercase mb-2 inline-block shadow-sm">Free Delivery</span>
                    <h1 class="text-2xl md:text-4xl font-bold mb-3 leading-tight">Freshness <br/> Delivered Daily</h1>
                    <p class="mb-4 text-green-100 max-w-lg text-sm md:text-base">Get up to 40% OFF on your daily staples. From the farm directly to your kitchen table.</p>
                    <button onclick="scrollToSection('best-deals')" class="bg-green-600 text-white border-2 border-transparent px-5 py-2 rounded-lg font-bold text-sm md:text-base hover:bg-green-700 hover:border-green-500 transition shadow-lg">
                        Shop Best Deals
                    </button>
                </div>
            </section>

            <!-- Categories Slider (COMPACT SECTION) -->
            <section class="container mx-auto px-4 lg:px-12 mb-6 relative group">
                <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <i data-lucide="layout-grid" class="w-5 h-5 text-green-600"></i> Shop by Category
                </h2>
                
                <!-- Slider Wrapper -->
                <div class="relative w-full overflow-hidden px-2 py-2">
                    <!-- Navigation Arrows -->
                    <button id="slider-prev" onclick="moveSlider(-1)" class="absolute left-0 top-1/2 -translate-y-1/2 z-20 bg-white p-1.5 rounded-full shadow-lg border border-gray-100 text-gray-600 hover:text-green-600 hover:bg-green-50 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100">
                        <i data-lucide="chevron-left" class="w-5 h-5"></i>
                    </button>
                    <button id="slider-next" onclick="moveSlider(1)" class="absolute right-0 top-1/2 -translate-y-1/2 z-20 bg-white p-1.5 rounded-full shadow-lg border border-gray-100 text-gray-600 hover:text-green-600 hover:bg-green-50 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100">
                        <i data-lucide="chevron-right" class="w-5 h-5"></i>
                    </button>

                    <!-- Slider Track -->
                    <div id="category-track" class="flex transition-transform duration-500 ease-in-out">
                        <!-- Categories injected by JS here -->
                    </div>
                </div>
            </section>

            <!-- Best Deals Section (COMPACT SECTION) -->
            <section id="best-deals" class="container mx-auto px-4 lg:px-12 mb-8 bg-white p-4 rounded-xl border border-red-100 shadow-sm">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <h2 class="text-lg md:text-2xl font-bold text-red-700 flex items-center gap-2">
                            <i data-lucide="percent" class="w-5 h-5 md:w-6 md:h-6"></i> Top Saver Deals
                        </h2>
                        <p class="text-red-500 text-xs md:text-sm mt-0.5">Huge savings on daily essentials</p>
                    </div>
                </div>
                <!-- Adjusted gap for better fit -->
                <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6" id="deals-grid">
                    <!-- Injected by JS -->
                </div>
            </section>
        </div>

        <!-- === CATEGORY PAGE VIEW (Initially Hidden) === -->
        <div id="category-view" class="hidden min-h-screen bg-gray-50 pb-20">
            <!-- Category Header -->
            <div class="bg-white shadow-sm border-b mb-6">
                <div class="container mx-auto px-4 lg:px-12 py-6">
                    <button onclick="renderHome()" class="text-gray-500 hover:text-green-600 flex items-center mb-4 text-sm font-medium transition-colors">
                        <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i> Back to Home
                    </button>
                    <div class="flex items-center gap-4">
                         <h1 id="category-page-title" class="text-3xl font-bold text-gray-800">Category Name</h1>
                         <span id="category-item-count" class="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded-full">0 items</span>
                    </div>
                </div>
            </div>

            <!-- Category Products Grid -->
            <div class="container mx-auto px-4 lg:px-12">
                 <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="category-page-grid">
                     <!-- Injected by JS -->
                 </div>
            </div>
        </div>

        <!-- === CHECKOUT VIEW (Hidden) === -->
        <div id="checkout-view" class="hidden container mx-auto px-4 lg:px-12 py-8 min-h-screen">
            <button onclick="renderHome()" class="mb-6 flex items-center text-gray-500 hover:text-green-600">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i> Continue Shopping
            </button>
            
            <h2 class="text-2xl font-bold mb-6">Secure Checkout</h2>
            
            <form onsubmit="placeOrder(event)" class="flex flex-col lg:flex-row gap-8">
                <div class="lg:w-2/3 space-y-6">
                    <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center mb-4">
                            <span class="w-8 h-8 rounded-full bg-green-100 text-green-700 flex items-center justify-center font-bold mr-3">1</span>
                            <h3 class="text-lg font-bold">Delivery Address</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ml-11">
                            <!-- Fields will be auto-filled by JS -->
                            <input type="text" id="checkout-name" required placeholder="Name" class="input-field border rounded p-2 w-full focus:ring-green-500 focus:border-green-500">
                            
                            <div class="flex w-full">
                                <span class="input-group-text p-2 bg-gray-50 border rounded-l border-r-0">+91</span>
                                <input type="tel" id="checkout-mobile" required maxlength="10" pattern="[0-9]{10}" placeholder="Mobile Number" class="input-field border rounded-r p-2 w-full border-l-0 focus:ring-green-500 focus:border-green-500 focus:outline-none" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            </div>

                            <input type="text" id="checkout-address" required placeholder="Flat / House No / Street" class="input-field border rounded p-2 w-full md:col-span-2">
                            <input type="text" id="checkout-city" required placeholder="City" class="input-field border rounded p-2 w-full">
                            <input type="text" id="checkout-pincode" required placeholder="Pincode" maxlength="6" pattern="[0-9]{6}" class="input-field border rounded p-2 w-full">
                        </div>
                    </div>
                    <!-- Payment Section -->
                    <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center mb-4">
                            <span class="w-8 h-8 rounded-full bg-green-100 text-green-700 flex items-center justify-center font-bold mr-3">2</span>
                            <h3 class="text-lg font-bold">Payment Method</h3>
                        </div>
                        <div class="space-y-3 ml-11">
                            
                            <!-- UPI Payment Option -->
                            <div class="border rounded-lg overflow-hidden">
                                <label class="flex items-center p-3 cursor-pointer hover:bg-gray-50 has-[:checked]:bg-green-50">
                                    <input type="radio" name="payment" value="upi" class="mr-3 text-green-600 focus:ring-green-500" checked onchange="togglePaymentDetails()">
                                    <div class="flex-1">
                                        <span class="block font-medium">UPI (GPay, PhonePe, Paytm)</span>
                                    </div>
                                    <i data-lucide="smartphone" class="w-5 h-5 text-gray-400"></i>
                                </label>
                                <!-- UPI ID Input (Visible only when UPI is selected) -->
                                <div id="upi-input-container" class="bg-gray-50 p-3 border-t">
                                    <input type="text" placeholder="Enter UPI ID (e.g. mobile@upi)" class="w-full border border-gray-300 rounded p-2 text-sm focus:border-green-500 focus:outline-none">
                                    <p class="text-xs text-gray-500 mt-1">A payment request will be sent to this ID.</p>
                                </div>
                            </div>

                            <!-- COD Payment Option -->
                            <div class="border rounded-lg overflow-hidden">
                                <label class="flex items-center p-3 cursor-pointer hover:bg-gray-50 has-[:checked]:bg-green-50">
                                    <input type="radio" name="payment" value="cod" class="mr-3 text-green-600 focus:ring-green-500" onchange="togglePaymentDetails()">
                                    <div class="flex-1">
                                        <span class="block font-medium">Cash on Delivery</span>
                                    </div>
                                    <i data-lucide="banknote" class="w-5 h-5 text-gray-400"></i>
                                </label>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- Order Summary Side Panel -->
                <div class="lg:w-1/3">
                    <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm sticky top-24">
                        <h3 class="font-bold text-gray-800 mb-4 pb-2 border-b">Order Summary</h3>
                        <div id="checkout-items" class="space-y-2 mb-4 max-h-60 overflow-y-auto text-sm"></div>
                        <div class="border-t pt-4 space-y-2 font-medium text-gray-600">
                            <div class="flex justify-between"><span>Subtotal</span><span id="checkout-subtotal">₹0</span></div>
                            <div class="flex justify-between text-green-600"><span>Delivery</span><span>FREE</span></div>
                            <div class="flex justify-between text-lg font-bold text-gray-900 mt-2"><span>Total</span><span id="checkout-total">₹0</span></div>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg mt-6 font-bold hover:bg-green-700 transition shadow-lg">Place Order</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-12 border-t border-gray-800 mt-auto">
        <div class="container mx-auto px-4 lg:px-12 grid grid-cols-1 md:grid-cols-3 gap-8 text-sm">
            <!-- Footer Content -->
            <div>
                <h3 class="text-white font-bold text-lg mb-4 flex items-center gap-2">
                    <i data-lucide="store" class="w-5 h-5 text-green-500"></i> About Apna Kirana
                </h3>
                <p class="leading-relaxed mb-4 text-gray-400">
                    Apna Kirana is your trusted neighborhood grocery store, now online. We connect you to local inventory, ensuring the freshest produce and fastest delivery.
                </p>
            </div>
            <div>
                <h3 class="text-white font-bold text-lg mb-4">Policies</h3>
                <ul class="space-y-2">
                    <li><a href="#" class="hover:text-green-400">Privacy Policy</a></li>
                    <li><a href="#" class="hover:text-green-400">Terms & Conditions</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-white font-bold text-lg mb-4">Contact</h3>
                <p>support@apnakirana.com</p>
            </div>
        </div>
    </footer>

    <!-- === MODALS === -->

    <!-- Welcome Modal -->
    <div id="welcome-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black bg-opacity-70 backdrop-blur-sm"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden pop-in text-center p-8">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600">
                <i data-lucide="shopping-basket" class="w-10 h-10"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome to Apna Kirana!</h2>
            <p class="text-gray-500 mb-8">Get <strong>flat 20% OFF</strong> on your first order.</p>
            <button onclick="closeWelcomeModal()" class="w-full bg-green-600 text-white py-3.5 rounded-xl font-bold text-lg hover:bg-green-700 transition-colors shadow-lg">Start Shopping</button>
        </div>
    </div>

    <!-- UNIFIED LOGIN POPUP -->
    <div id="login-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm" onclick="toggleModal('login-modal')"></div>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md relative z-10 overflow-hidden animate-fade-in">
            <div class="bg-green-50 p-6 text-center border-b border-green-100">
                <h3 class="text-2xl font-bold text-green-800">Login / Sign Up</h3>
                <p class="text-green-600 text-sm">Enter details to save them for checkout</p>
            </div>
            <form onsubmit="handleUnifiedLogin(event)" class="p-6 space-y-4">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="login-name" required class="w-full border rounded-lg p-2.5 focus:border-green-500 outline-none">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Mobile Number</label>
                    <div class="flex">
                        <span class="input-group-text p-2 bg-gray-50 border rounded-l border-r-0">+91</span>
                        <input type="tel" id="login-mobile" required maxlength="10" pattern="[0-9]{10}" class="w-full border rounded-r-lg p-2.5 border-l-0 focus:border-green-500 outline-none" placeholder="XXXXXXXXXX" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                    </div>
                </div>

                <div class="border-t pt-4 mt-2">
                    <p class="text-xs text-gray-500 uppercase font-bold mb-3">Delivery Address (Auto-Save)</p>
                    <div class="space-y-3">
                        <input type="text" id="login-address" required placeholder="Flat No, Building, Street" class="w-full border rounded-lg p-2.5 focus:border-green-500 outline-none">
                        <div class="grid grid-cols-2 gap-3">
                            <input type="text" id="login-city" required placeholder="City" class="w-full border rounded-lg p-2.5 focus:border-green-500 outline-none">
                            <input type="text" id="login-pincode" required placeholder="Pincode" maxlength="6" pattern="[0-9]{6}" class="w-full border rounded-lg p-2.5 focus:border-green-500 outline-none">
                        </div>
                    </div>
                </div>

                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 shadow-md mt-4">Login & Save Details</button>
            </form>
            <button onclick="toggleModal('login-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i data-lucide="x"></i></button>
        </div>
    </div>

    <!-- Order Success Modal -->
    <div id="order-success-modal" class="fixed inset-0 z-[90] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black bg-opacity-70 backdrop-blur-sm"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden pop-in text-center p-8">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600">
                <i data-lucide="check-circle" class="w-10 h-10"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Order Placed!</h2>
            <p class="text-gray-600 mb-6">Order <span id="success-order-id" class="font-bold text-black">#00000</span> confirmed.</p>
            <button onclick="closeOrderSuccess()" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition">Continue Shopping</button>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cart-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="toggleModal('cart-modal')"></div>
        <div class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl transform transition-transform duration-300 translate-x-full" id="cart-panel">
            <div class="flex flex-col h-full">
                <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                    <h3 class="font-bold text-lg flex items-center gap-2"><i data-lucide="shopping-bag" class="w-5 h-5 text-green-600"></i> My Basket</h3>
                    <button onclick="toggleModal('cart-modal')" class="text-gray-500 hover:text-red-500"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <div id="cart-items-container" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
                <div class="p-4 border-t bg-gray-50">
                    <div class="flex justify-between mb-4 font-bold text-lg"><span>Total</span><span id="cart-total-display">₹0</span></div>
                    <button onclick="proceedToCheckout()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition">Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Location Modal -->
    <div id="location-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm" onclick="toggleModal('location-modal')"></div>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm relative z-10 p-6">
            <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg">Select Location</h3><button onclick="toggleModal('location-modal')"><i data-lucide="x" class="w-5 h-5 text-gray-400"></i></button></div>
            <div class="space-y-2">
                <button onclick="setLocation('Mumbai, 400001')" class="w-full text-left p-3 rounded border hover:bg-green-50 hover:border-green-500 transition">Mumbai, 400001</button>
                <button onclick="setLocation('Delhi, 110001')" class="w-full text-left p-3 rounded border hover:bg-green-50 hover:border-green-500 transition">Delhi, 110001</button>
                <button onclick="setLocation('Bangalore, 560001')" class="w-full text-left p-3 rounded border hover:bg-green-50 hover:border-green-500 transition">Bangalore, 560001</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // === DATA: MERGED FROM SCRIPT.JS ===
        const categories = [
            { id: 'fv', name: "Fruits & Veggies", image: "image/veg.jpg" },
            { id: 'fm', name: "Foodgrains",       image: "image/foodgrain.jpg" },
            { id: 'bd', name: "Bakery & Dairy",   image: "image/bakery.jpg" },
            { id: 'sn', name: "Snacks",           image: "image/snacks.jpg" },
            { id: 'bv', name: "Drinks",           image: "image/drink.jpg" },
            { id: 'df', name: "Dry Fruits",       image: "image/dryfruit.jpg" },
            { id: 'dn', name: "Daily Need",       image: "image/dailyneed.jpg" },
            { id: 'ma', name: "Masala",           image: "image/masala.jpg" },
        ];
        
        const products = [
            { id: 1, name: "Fresh Red Onion", category: "Fruits & Veggies", price: 35, unit: "1 kg", image: "image/onion.jpg", discount: 25 },
            { id: 2, name: "Farm Potatoes", category: "Fruits & Veggies", price: 40, unit: "1 kg", image: "image/potato.jpg", discount: 10 },
            { id: 3, name: "Fresh Tomatoes", category: "Fruits & Veggies", price: 25, unit: "1 kg", image: "image/tomato.jpg", discount: 5 },
            { id: 11, name: "Green Chili", category: "Fruits & Veggies", price: 15, unit: "200 g", image: "image/chilli.jpg", discount: 0 },
            { id: 4, name: "Sliver Coin Wheat Atta", category: "Foodgrains", price: 450, unit: "10 kg", image: "image/atta.jpg", discount: 15 },
            { id: 5, name: "Toor Dal", category: "Foodgrains", price: 140, unit: "1 kg", image: "image/toordal.jpg", discount: 0 },
            { id: 6, name: "Amul Butter", category: "Bakery & Dairy", price: 56, unit: "100 g", image: "image/butter.jpg", discount: 2 },
            { id: 7, name: "Amul Milk", category: "Bakery & Dairy", price: 32, unit: "500 ml", image: "image/milk.jpg", discount: 0 },
            { id: 9, name: "Maggi", category: "Snacks", price: 14, unit: "70 g", image: "image/maggi.jpg", discount: 0 },
            { id: 10, name: "Mazza", category: "Drinks", price: 650, unit: "1 kg", image: "image/mazza.jpg", discount: 20 },
            { id: 23, name: "Premium Almonds (Badam)", category: "Dry Fruits", price: 850, unit: "500 g", image: "image/badam.jpg", discount: 10 },
            { id: 24, name: "Whole Cashews (Kaju)", category: "Dry Fruits", price: 750, unit: "500 g", image: "image/kaju.jpg", discount: 5 },
            { id: 25, name: "Golden Raisins (Kishmish)", category: "Dry Fruits", price: 250, unit: "250 g", image: "image/kishmish.jpg", discount: 0 },
            { id: 26, name: "Walnut Kernels (Akhrot)", category: "Dry Fruits", price: 600, unit: "250 g", image: "image/akhrod.jpg", discount: 15 },
            { id: 27, name: "Roasted Pistachios (Pista)", category: "Dry Fruits", price: 900, unit: "500 g", image: "image/pista.jpg", discount: 20 },
            { id: 28, name: "Taj Tea", category: "Daily Need", price: 320, unit: "500 g", image: "image/taj.jpg", discount: 0 },
            { id: 29, name: "Silver Coin Rava", category: "Daily Need", price: 85, unit: "500 g", image: "image/rava.jpg", discount: 0 },
            { id: 30, name: "Poha", category: "Daily Need", price: 55, unit: "500 g", image: "image/poha.jpg", discount: 0 },
            { id: 31, name: "Sugar", category: "Daily Need", price: 40, unit: "500 g", image: "image/sugar.jpg", discount: 1 },
            { id: 32, name: "Tata Salt", category: "Daily Need", price: 20, unit: "500 g", image: "image/salt.jpg", discount: 0 },
            { id: 33, name: "Lays Chips", category: "Snacks", price: 100, unit: "500 g", image: "image/lays.jpg", discount: 0 },
            { id: 34, name: "Balaji Chips", category: "Snacks", price: 90, unit: "500 g", image: "image/balaji.jpg", discount: 1 },
            { id: 35, name: "Bikaji Bhujiya", category: "Snacks", price: 175, unit: "500 g", image: "image/bikaji.jpg", discount: 3 },
            { id: 36, name: "Chitale Bakarwadi", category: "Snacks", price: 350, unit: "500 g", image: "image/chitale.jpg", discount: 0 },
            { id: 37, name: "Apple", category: "Fruits & Veggies", price: 150, unit: "500 g", image: "image/apple.jpg", discount: 2 },
            { id: 38, name: "Banana", category: "Fruits & Veggies", price: 50, unit: "1 dozen", image: "image/banana.jpg", discount: 0 },
            { id: 39, name: "Orange", category: "Fruits & Veggies", price: 120, unit: "1 kg", image: "image/orange.jpg", discount: 1 },
            { id: 40, name: "Coca Cola", category: "Drinks", price: 40, unit: "100 ml", image: "image/coca.jpg", discount: 0 },
            { id: 41, name: "Amul Cool", category: "Drinks", price: 25, unit: "60 ml", image: "image/cool.jpg", discount: 0 },
            { id: 42, name: "Red chilli Powder", category: "Masala", price: 325, unit: "1 kg", image: "image/redchilli.jpg", discount: 5 },
            { id: 43, name: "Turmeric", category: "Masala", price: 240, unit: "1 kg", image: "image/turmeric.jpg", discount: 0 },
            { id: 44, name: "Butter Milk", category: "Bakery & Dairy", price: 120, unit: "200 g", image: "image/buttermik.jpg", discount: 0 },
            { id: 45, name: "Amul Cheese", category: "Bakery & Dairy", price: 70, unit: "100 ml", image: "image/chess.jpg", discount: 0 },
        ];

        // UPDATED: Added 'background.jpg' to the beginning of the array
        const heroImages = [
            "background.jpg", 
            "slider1.jpg",
        ];

        // === SLIDER LOGIC ===
        let currentIndex = 0;
        let sliderInterval;
        const visibleCards = 4;

        function initSlider() {
            const track = document.getElementById('category-track');
            track.innerHTML = '';
            
            categories.forEach(cat => {
                const card = document.createElement('div');
                // COMPACT: w-20 h-20 on mobile
                card.className = 'flex-none w-1/4 px-2 flex flex-col items-center cursor-pointer group transition-transform hover:scale-105';
                card.onclick = () => showCategoryPage(cat.name);
                
                // COMPACT: w-20 h-20 circles on mobile
                card.innerHTML = `
                    <div class="w-20 h-20 md:w-28 md:h-28 rounded-full overflow-hidden border-4 border-green-100 shadow-md category-card-shadow mb-2 bg-white">
                        <img src="${cat.image}" 
                             onerror="this.src='https://images.unsplash.com/photo-1542838132-92c53300491e?w=200&h=200&fit=crop'"
                             alt="${cat.name}" 
                             class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                    </div>
                    <span class="font-medium text-gray-700 group-hover:text-green-700 text-center text-xs md:text-base">${cat.name}</span>
                `;
                track.appendChild(card);
            });

            startAutoSlide();
            
            const container = document.querySelector('#hero-slider').nextElementSibling;
            container.addEventListener('mouseenter', stopAutoSlide);
            container.addEventListener('mouseleave', startAutoSlide);
        }

        function moveSlider(direction) {
            const track = document.getElementById('category-track');
            const totalItems = categories.length;
            const itemWidth = 100 / visibleCards; 
            
            currentIndex += direction;

            if (currentIndex > totalItems - visibleCards) {
                currentIndex = 0;
            } else if (currentIndex < 0) {
                currentIndex = totalItems - visibleCards;
            }

            const translateX = -(currentIndex * itemWidth);
            track.style.transform = `translateX(${translateX}%)`;
        }

        function startAutoSlide() {
            stopAutoSlide(); 
            sliderInterval = setInterval(() => {
                moveSlider(1);
            }, 3000); 
        }

        function stopAutoSlide() {
            clearInterval(sliderInterval);
        }

        // === HERO SLIDER LOGIC ===
        let currentHeroImage = 0;
        function startHeroSlider() {
            const heroSection = document.getElementById('hero-slider');
            if (!heroSection) return;

            // Set initial image
            heroSection.style.backgroundImage = `url('${heroImages[0]}')`;

            setInterval(() => {
                currentHeroImage = (currentHeroImage + 1) % heroImages.length;
                heroSection.style.backgroundImage = `url('${heroImages[currentHeroImage]}')`;
            }, 5000); // 5 seconds
        }

        // === APP LOGIC ===
        let cart = [];
        let isLoggedIn = false;
        let savedUser = { name: '', mobile: '', address: '', city: '', pincode: '' };

        function init() {
            lucide.createIcons();
            initSlider();
            startHeroSlider();
            renderBestDeals();
            renderNavCategories();
            
            // Welcome modal
            setTimeout(() => {
               // document.getElementById('welcome-modal').classList.remove('hidden');
            }, 1000);
        }

        function renderBestDeals() {
            const grid = document.getElementById('deals-grid');
            // Logic from script.js: Filter products with discount >= 10
            const deals = products.filter(p => p.discount >= 10).sort((a,b) => b.discount - a.discount);
            
            grid.innerHTML = deals.map(item => createProductCard(item)).join('');
            lucide.createIcons();
        }
        
        function renderNavCategories() {
            const list = document.getElementById('nav-categories');
            list.innerHTML = categories.map(cat => 
                `<li class="cursor-pointer whitespace-nowrap hover:text-green-600 transition" onclick="showCategoryPage('${cat.name}')">${cat.name}</li>`
            ).join('');
        }

        function createProductCard(product) {
            // Logic to calculate original price from discount
            const originalPrice = Math.round(product.price * (100 / (100 - product.discount)));
            const inCart = cart.find(c => c.id === product.id);
            const qty = inCart ? inCart.qty : 0;

            // COMPACT: Reduced padding (p-3), smaller image container (h-28 md:h-32), and object-contain
            return `
            <div class="product-card bg-white rounded-lg border border-gray-200 p-3 flex flex-col h-full relative group hover:shadow-lg transition-shadow">
                ${product.discount > 0 ? `<span class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded z-10 shadow-sm">${product.discount}% OFF</span>` : ''}
                
                <!-- Fixed aspect ratio container to ensure consistent alignment -->
                <div class="relative w-full aspect-[4/3] mb-2 overflow-hidden rounded-md bg-white flex items-center justify-center">
                    <img src="${product.image}" 
                         onerror="this.src='https://images.unsplash.com/photo-1589123053646-4e0c8b4172a6?w=200&h=200&fit=crop'"
                         alt="${product.name}" 
                         class="w-full h-full object-contain p-1 transition-transform duration-300 group-hover:scale-105">
                </div>
                
                <div class="text-[10px] text-gray-500 mb-0.5 uppercase tracking-wide">${product.category}</div>
                <h3 class="font-semibold text-gray-800 text-xs md:text-sm mb-1 line-clamp-2 h-8 md:h-10">${product.name}</h3>
                <div class="text-[10px] md:text-xs text-gray-500 mb-2 bg-gray-50 inline-block px-1.5 py-0.5 rounded border border-gray-100 w-fit">${product.unit}</div>
                
                <div class="mt-auto flex items-center justify-between">
                    <div>
                        <span class="text-sm md:text-base font-bold text-gray-900">₹${product.price}</span>
                        ${product.discount > 0 ? `<span class="text-[10px] md:text-xs text-gray-400 line-through ml-1">₹${originalPrice}</span>` : ''}
                    </div>
                    
                    ${qty > 0 ? `
                        <div class="flex items-center bg-green-600 rounded text-white shadow-md">
                            <button onclick="updateQty(${product.id}, -1)" class="px-1.5 py-1 hover:bg-green-700 transition">-</button>
                            <span class="px-1.5 text-xs font-bold min-w-[16px] text-center">${qty}</span>
                            <button onclick="updateQty(${product.id}, 1)" class="px-1.5 py-1 hover:bg-green-700 transition">+</button>
                        </div>
                    ` : `
                        <button onclick="addToCart(${product.id})" class="border border-green-600 text-green-600 hover:bg-green-600 hover:text-white px-3 py-1 rounded text-xs md:text-sm font-bold transition">Add</button>
                    `}
                </div>
            </div>
            `;
        }

        function showCategoryPage(categoryName) {
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('checkout-view').classList.add('hidden');
            document.getElementById('category-view').classList.remove('hidden');
            document.getElementById('category-page-title').innerText = categoryName;
            
            // Filter products from the merged data
            const filteredProducts = products.filter(p => p.category === categoryName || (categoryName.includes(p.category))); // Loose match for things like 'Foodgrains' vs 'Foodgrains '
            
            const grid = document.getElementById('category-page-grid');
            
            if (filteredProducts.length > 0) {
                 grid.innerHTML = filteredProducts.map(product => createProductCard(product)).join('');
                 document.getElementById('category-item-count').innerText = `${filteredProducts.length} items`;
            } else {
                 grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500">No products found for this category.</div>`;
                 document.getElementById('category-item-count').innerText = `0 items`;
            }
            window.scrollTo(0,0);
        }

        function renderHome() {
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('category-view').classList.add('hidden');
            document.getElementById('checkout-view').classList.add('hidden');
            window.scrollTo(0,0);
        }

        // --- MERGED CART LOGIC ---

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            if(product) {
                cart.push({ ...product, qty: 1 });
                refreshUI();
            }
        }

        function updateQty(id, delta) {
            const itemIndex = cart.findIndex(c => c.id === id);
            if (itemIndex > -1) {
                cart[itemIndex].qty += delta;
                if (cart[itemIndex].qty <= 0) {
                    cart.splice(itemIndex, 1);
                }
            }
            refreshUI();
        }

        function refreshUI() {
            updateCartUI();
            // Re-render views to update buttons state
            if (!document.getElementById('home-view').classList.contains('hidden')) {
                renderBestDeals();
            }
            if (!document.getElementById('category-view').classList.contains('hidden')) {
                const currentTitle = document.getElementById('category-page-title').innerText;
                showCategoryPage(currentTitle);
            }
        }

        function updateCartUI() {
            const count = cart.reduce((sum, item) => sum + item.qty, 0);
            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            
            document.getElementById('cart-count').innerText = count;
            document.getElementById('cart-total-display').innerText = '₹' + total;
            document.getElementById('checkout-subtotal').innerText = '₹' + total;
            document.getElementById('checkout-total').innerText = '₹' + total;
            
            // Render cart items
            const container = document.getElementById('cart-items-container');
            const checkoutItems = document.getElementById('checkout-items');
            
            if(cart.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-500 mt-10">Basket is empty</div>`;
                checkoutItems.innerHTML = `<div class="text-center text-gray-500 text-sm">Basket is empty</div>`;
            } else {
                const cartHTML = cart.map(item => `
                    <div class="flex gap-3 mb-4 items-center">
                        <img src="${item.image}" onerror="this.src='https://images.unsplash.com/photo-1589123053646-4e0c8b4172a6?w=200&h=200&fit=crop'" class="w-16 h-16 object-cover rounded">
                        <div class="flex-1">
                            <p class="font-medium text-sm line-clamp-1">${item.name}</p>
                            <p class="font-bold text-sm">₹${item.price} x ${item.qty}</p>
                        </div>
                        <div class="flex items-center border rounded bg-gray-50">
                            <button onclick="updateQty(${item.id}, -1)" class="px-2 py-1 hover:bg-gray-200">-</button>
                            <span class="text-xs font-bold px-1">${item.qty}</span>
                            <button onclick="updateQty(${item.id}, 1)" class="px-2 py-1 hover:bg-gray-200">+</button>
                        </div>
                    </div>
                `).join('');
                container.innerHTML = cartHTML;
                
                checkoutItems.innerHTML = cart.map(item => `
                     <div class="flex justify-between text-gray-600 mb-2 text-xs">
                        <span class="truncate w-2/3">${item.name} x${item.qty}</span>
                        <span>₹${item.price * item.qty}</span>
                     </div>
                `).join('');
            }
        }

        // --- UTILS & MODALS ---

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            const panel = document.getElementById('cart-panel');
            
            if (modalId === 'cart-modal') {
                if(modal.classList.contains('hidden')) {
                    modal.classList.remove('hidden');
                    setTimeout(() => panel.classList.remove('translate-x-full'), 10);
                } else {
                    panel.classList.add('translate-x-full');
                    setTimeout(() => modal.classList.add('hidden'), 300);
                }
            } else {
                modal.classList.toggle('hidden');
            }
        }

        function showCart() {
            toggleModal('cart-modal');
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({behavior: 'smooth'});
        }

        function setLocation(loc) {
            document.getElementById('current-location').innerText = loc;
            toggleModal('location-modal');
        }
        
        function handleUnifiedLogin(e) {
            e.preventDefault();
            const name = document.getElementById('login-name').value;
            const mobile = document.getElementById('login-mobile').value;
            const address = document.getElementById('login-address').value;
            const city = document.getElementById('login-city').value;
            const pincode = document.getElementById('login-pincode').value;

            // Simple validation from script.js
            if(name && mobile.length === 10) {
                 savedUser = { name, mobile, address, city, pincode };
                 isLoggedIn = true;
                 document.getElementById('user-name').innerText = name.split(' ')[0];
                 toggleModal('login-modal');
                 
                 // Auto fill checkout
                 document.getElementById('checkout-name').value = name;
                 document.getElementById('checkout-mobile').value = mobile;
                 document.getElementById('checkout-address').value = address;
                 document.getElementById('checkout-city').value = city;
                 document.getElementById('checkout-pincode').value = pincode;
            } else {
                alert("Please enter valid details");
            }
        }

        function proceedToCheckout() {
            if(cart.length === 0) {
                alert("Basket is empty!");
                return;
            }
            if(!isLoggedIn) {
                 toggleModal('cart-modal');
                 toggleModal('login-modal');
                 return;
            }
            toggleModal('cart-modal');
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('category-view').classList.add('hidden');
            document.getElementById('checkout-view').classList.remove('hidden');
            window.scrollTo(0,0);
        }
        
        function togglePaymentDetails() {
            const upiRadio = document.querySelector('input[value="upi"]');
            const upiInput = document.getElementById('upi-input-container');
            if(upiRadio.checked) {
                upiInput.classList.remove('hidden');
            } else {
                upiInput.classList.add('hidden');
            }
        }

        function placeOrder(e) {
            e.preventDefault();
            const id = Math.floor(10000 + Math.random() * 90000);
            document.getElementById('success-order-id').innerText = "#" + id;
            document.getElementById('order-success-modal').classList.remove('hidden');
        }

        function closeOrderSuccess() {
            document.getElementById('order-success-modal').classList.add('hidden');
            cart = [];
            refreshUI();
            renderHome();
        }

        function closeWelcomeModal() {
            document.getElementById('welcome-modal').classList.add('hidden');
        }

        // Search Listener
        document.getElementById('search-input').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            if (term.length > 0) {
                document.getElementById('home-view').classList.add('hidden');
                document.getElementById('category-view').classList.remove('hidden');
                document.getElementById('category-page-title').innerText = `Search: "${e.target.value}"`;
                
                const filtered = products.filter(p => p.name.toLowerCase().includes(term));
                document.getElementById('category-item-count').innerText = `${filtered.length} items`;
                
                const grid = document.getElementById('category-page-grid');
                if (filtered.length > 0) {
                    grid.innerHTML = filtered.map(product => createProductCard(product)).join('');
                } else {
                    grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500">No products found matching "${e.target.value}"</div>`;
                }
            } else {
                renderHome();
            }
        });

        // Initialize on load
        window.onload = init;

    </script>
</body>
</html>